<!DOCTYPE HTML>
<html>
	<head>
		<title>RowErg Diary - Backup Management</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
		<link rel="stylesheet" href="{{ url_for('static', filename='css/mystyles.css') }}" />
	</head>
	<body class="is-preload">

		<!-- == Main Content Area ============================================ -->
		<div id="content" class="custom-fullwidth">
			<div class="inner">
				<!-- -- Page Header ------------------- -->
				<h1 class="extra_h1">Backup Management</h1>
				<hr class="extra_title_line">

				<!-- -- Flash Messages Section ------------------- -->
				{% with messages = get_flashed_messages(with_categories=true) %}
					{% if messages %}
						<article class="box post post-excerpt">
						{% for category, message in messages %}
							<div class="box alert-{{ category }}" style="font-size: 1.3em; border: 1px solid; padding: 16px; margin-bottom: 20px; text-align: center;">
								{{ message }}
							</div>
						{% endfor %}
						</article>
					{% endif %}
				{% endwith %}
					
				<!-- -- Create Backup Section ------------------- -->
				<section class="box">
					<header>
						<h2>Create New Backup</h2>
					</header>
					<div class="content">
						<p>Click the button below to create a new backup of your application data. The backup will be stored as a .zip file in the designated backup directory.</p>
						<a href="{{ url_for('backup_management.create_export') }}" class="button primary icon solid fa-download">Create New Backup</a>
					</div>
				</section>

				<hr class="extra_article">

				<!-- -- Restore Backup Section ------------------- -->
				<section class="box">
					<header>
						<h2>Restore from Backup</h2>
					</header>
					<div class="content">
						{% if backups %}
							<p>Select a backup file from the list below to restore your application data. <strong>Warning:</strong> Restoring from a backup will overwrite all current data in the database.</p>
							
							<h3 style="margin-top: 1em;">Available Backups:</h3>
							<ul style="list-style: none; padding-left: 0;">
								{% for backup_file in backups %}
									<li style="margin-bottom: 0.5em; padding: 0.5em; border: 1px solid #eee; border-radius: 4px; display: flex; justify-content: space-between; align-items: center;">
										<span>{{ backup_file }}</span>
										<div>
											<a href="{{ url_for('backup_management.download_backup', filename=backup_file) }}" class="button small icon solid fa-download" style="margin-left: 1em; margin-right: 0.5em;">Download</a>
											<form method="POST" action="{{ url_for('backup_management.restore_export') }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to restore from {{ backup_file }}? This will overwrite all current data.');">
												<input type="hidden" name="backup_filename" value="{{ backup_file }}">
												<button type="submit" class="button small primary icon solid fa-upload">Restore</button>
											</form>
										</div>
									</li>
								{% endfor %}
							</ul>
						{% else %}
							<p>No backup files found. Create a backup first.</p>
						{% endif %}
					</div>
				</section>

				<!-- -- Back Link Section (Optional) --- -->
				<div class="back-link-container" style="text-align: center; margin-top: 30px;">
					<a href="{{ url_for('home') }}" class="back-link" style="display: inline-block; padding: 8px 22px; background: #f3f3f3; border-radius: 6px; color: #333; text-decoration: none; font-weight: 500; transition: background 0.15s; border: 1px solid #e0e0e0;">
						‚Üê Back to Home
					</a>
				</div>

			</div>
		</div>
		<!-- == Sidebar Inclusion ============================================ -->
		{% include '_sidebar.html' %}

		<!-- == Scripts ============================================ -->
		<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/browser.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/breakpoints.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/util.js') }}"></script>
		<script src="{{ url_for('static', filename='js/main.js') }}"></script>
	</body>
</html>
